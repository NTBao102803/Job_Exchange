import React, { useState, useEffect } from "react";
import { Eye, Edit, Trash2, User, Search, Lock, Unlock } from "lucide-react";
import CandidateProfileModal from "../../components/candidate/CandidateProfileModal";
const AdminCandidate = () => {
  const [candidates, setCandidates] = useState([]);
  const [currentPage, setCurrentPage] = useState(1);
  const itemsPerPage = 4;

  const [searchEmail, setSearchEmail] = useState("");

  // üëâ Modal state
  const [isViewModalOpen, setIsViewModalOpen] = useState(false);
  const [selectedCandidate, setSelectedCandidate] = useState(null);

  const [isConfirmModalOpen, setIsConfirmModalOpen] = useState(false);
  const [candidateToToggle, setCandidateToToggle] = useState(null);


  useEffect(() => {
    const fetchCandidates = async () => {
      // Fake API data
      const data = [
        {
          id: 1,
          fullName: "Nguy·ªÖn VƒÉn A",
          email: "vana@example.com",
          status: "T·∫°m th·ªùi v√¥ hi·ªáu ho√°",
          major: "C√¥ng ngh·ªá th√¥ng tin",
          skills: "React, Node.js, SQL",
          experience: "2 nƒÉm",
          graduationYear: 2022,
          gpa: 3.4,
          dob: "1999-05-12",
          gender: "Nam",
          phone: "0901234567",
          address: "H√† N·ªôi",
          school: "ƒêH B√°ch Khoa",
          projects: "Website th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠",
          certificates: "IELTS 6.5",
          careerGoal: "Tr·ªü th√†nh fullstack developer",
          hobbies: "ƒê·ªçc s√°ch, ch∆°i b√≥ng ƒë√°",
          social: "linkedin.com/in/nguyenvana",
        },
        {
          id: 2,
          fullName: "Tr·∫ßn Th·ªã B",
          email: "thib@example.com",
          status: "ƒêang ho·∫°t ƒë·ªông",
          major: "Qu·∫£n tr·ªã kinh doanh",
          skills: "Excel, PowerBI",
          experience: "1 nƒÉm",
          graduationYear: 2021,
          gpa: 3.6,
          dob: "2000-01-10",
          gender: "N·ªØ",
          phone: "0909876543",
          address: "TP.HCM",
          school: "ƒêH Kinh t·∫ø",
          projects: "Qu·∫£n l√Ω b√°n h√†ng",
          certificates: "MOS Excel",
          careerGoal: "Qu·∫£n l√Ω d·ª± √°n",
          hobbies: "Du l·ªãch, n·∫•u ƒÉn",
          social: "facebook.com/tranthib",
        },
        {
          id: 3,
          fullName: "Tr·∫ßn Th·ªã B",
          email: "thib@example.com",
          status: "T·∫°m th·ªùi v√¥ hi·ªáu ho√°",
          major: "Qu·∫£n tr·ªã kinh doanh",
          skills: "Excel, PowerBI",
          experience: "1 nƒÉm",
          graduationYear: 2021,
          gpa: 3.6,
          dob: "2000-01-10",
          gender: "N·ªØ",
          phone: "0909876543",
          address: "TP.HCM",
          school: "ƒêH Kinh t·∫ø",
          projects: "Qu·∫£n l√Ω b√°n h√†ng",
          certificates: "MOS Excel",
          careerGoal: "Qu·∫£n l√Ω d·ª± √°n",
          hobbies: "Du l·ªãch, n·∫•u ƒÉn",
          social: "facebook.com/tranthib",
        },
        {
          id: 4,
          fullName: "Tr·∫ßn Th·ªã B",
          email: "thib@example.com",
          status: "T·∫°m th·ªùi v√¥ hi·ªáu ho√°",
          major: "Qu·∫£n tr·ªã kinh doanh",
          skills: "Excel, PowerBI",
          experience: "1 nƒÉm",
          graduationYear: 2021,
          gpa: 3.6,
          dob: "2000-01-10",
          gender: "N·ªØ",
          phone: "0909876543",
          address: "TP.HCM",
          school: "ƒêH Kinh t·∫ø",
          projects: "Qu·∫£n l√Ω b√°n h√†ng",
          certificates: "MOS Excel",
          careerGoal: "Qu·∫£n l√Ω d·ª± √°n",
          hobbies: "Du l·ªãch, n·∫•u ƒÉn",
          social: "facebook.com/tranthib",
        },
        {
          id: 5,
          fullName: "Tr·∫ßn Th·ªã B",
          email: "thib@example.com",
          status: "ƒêang ho·∫°t ƒë·ªông",
          major: "Qu·∫£n tr·ªã kinh doanh",
          skills: "Excel, PowerBI",
          experience: "1 nƒÉm",
          graduationYear: 2021,
          gpa: 3.6,
          dob: "2000-01-10",
          gender: "N·ªØ",
          phone: "0909876543",
          address: "TP.HCM",
          school: "ƒêH Kinh t·∫ø",
          projects: "Qu·∫£n l√Ω b√°n h√†ng",
          certificates: "MOS Excel",
          careerGoal: "Qu·∫£n l√Ω d·ª± √°n",
          hobbies: "Du l·ªãch, n·∫•u ƒÉn",
          social: "facebook.com/tranthib",
        },
      ];
      setCandidates(data);
    };
    fetchCandidates();
  }, []);

  const filteredCandidates = candidates.filter((c) => {
    const matchEmail = c.email.toLowerCase().includes(searchEmail.toLowerCase());
    return matchEmail ;
  });

  const totalPages = Math.ceil(filteredCandidates.length / itemsPerPage);
  const startIndex = (currentPage - 1) * itemsPerPage;
  const currentCandidates = filteredCandidates.slice(startIndex, startIndex + itemsPerPage);

  // M·ªü modal x√°c nh·∫≠n thay ƒë·ªïi tr·∫°ng th√°i
  const handleStatusClick = (candidate) => {
    setCandidateToToggle(candidate);
    setIsConfirmModalOpen(true);
  };

  const confirmToggleStatus = () => {
    if (candidateToToggle) {
      setCandidates((prev) =>
        prev.map((c) =>
          c.id === candidateToToggle.id
            ? {
                ...c,
                status:
                  c.status === "ƒêang ho·∫°t ƒë·ªông"
                    ? "T·∫°m th·ªùi v√¥ hi·ªáu h√≥a"
                    : "ƒêang ho·∫°t ƒë·ªông",
              }
            : c
        )
      );
      setCandidateToToggle(null);
      setIsConfirmModalOpen(false);
    }
  };

  const cancelToggleStatus = () => {
    setCandidateToToggle(null);
    setIsConfirmModalOpen(false);
  };
  return (
    <div className="p-1">
      <h1 className="text-3xl font-bold mb-6 text-gray-800">Qu·∫£n l√Ω ·ª©ng vi√™n</h1>

      {/* Thanh t√¨m ki·∫øm v√† l·ªçc */}
      <div className="flex flex-col sm:flex-row gap-4 mb-4 items-center mt-10">
        <div className="flex items-center bg-white rounded-lg shadow px-3 py-2 w-full sm:w-1/2">
          <Search className="text-gray-400 mr-2" size={18} />
          <input
            type="text"
            placeholder="T√¨m ki·∫øm theo email..."
            value={searchEmail}
            onChange={(e) => {
              setSearchEmail(e.target.value);
              setCurrentPage(1);
            }}
            className="flex-1 outline-none text-gray-700"
          />
        </div>

      </div>

      {/* B·∫£ng ·ª©ng vi√™n */}
      <div className="bg-gradient-to-r from-indigo-600 via-blue-500 to-cyan-500 p-6 rounded-2xl shadow-lg mt-10">
        <table className="w-full text-left border-collapse rounded-xl overflow-hidden">
          <thead>
            <tr className="bg-white/20 text-white uppercase text-sm tracking-wider">
              <th className="p-4">ID</th>
              <th className="p-4">·ª®ng vi√™n</th>
              <th className="p-4">Th√¥ng tin</th>
              <th className="p-4 text-center">H√†nh ƒë·ªông</th>
            </tr>
          </thead>
          <tbody>
            {currentCandidates.map((c) => (
              <tr key={c.id} className="bg-white/10 backdrop-blur-xl hover:bg-white/20 transition border-b border-white/30">
                <td className="p-4 font-semibold text-white">{c.id}</td>
                <td className="p-4 flex items-center gap-3 text-white">
                  <div className="bg-white/30 w-10 h-10 rounded-full flex items-center justify-center shadow-md">
                    <User className="text-white" size={20} />
                  </div>
                  <div>
                    <p className="font-bold">{c.fullName}</p>
                    <p className="text-xs opacity-80">{c.email}</p>
                  </div>
                </td>
                <td className="p-4 text-sm text-white space-y-1 max-w-[250px]">
                  <p className="truncate"><span className="font-semibold">Ng√†nh: </span>{c.major}</p>
                  <p className="truncate"><span className="font-semibold">K·ªπ nƒÉng: </span>{c.skills}</p>
                  <p className="truncate"><span className="font-semibold">T·ªët nghi·ªáp: </span>{c.graduationYear} ({c.gpa})</p>
                </td>
                <td className="p-4 text-center space-x-2">
                  <button onClick={() => handleView(c)} className="p-2 bg-white/30 rounded-lg hover:bg-white/40 text-white transition">
                    <Eye size={18} />
                  </button>
                  <button className="p-2 bg-red-500 rounded-lg hover:bg-red-400 text-white transition">
                    <Trash2 size={18} />
                  </button>
                  {/* N√∫t thay ƒë·ªïi tr·∫°ng th√°i */}
                  <button
                    onClick={() => handleStatusClick(c)}
                    className={`p-2 rounded-lg transition ${
                      c.status === "ƒêang ho·∫°t ƒë·ªông"
                        ? "bg-green-500 hover:bg-green-400 text-white"
                        : "bg-red-500 hover:bg-red-400 text-white"
                    }`}
                  >
                    {c.status === "ƒêang ho·∫°t ƒë·ªông" ? <Unlock size={18} /> : <Lock size={18} />}
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>

        {/* Ph√¢n trang */}
        <div className="flex flex-col sm:flex-row justify-between items-center mt-4 text-white">
          <span className="text-sm mb-2 sm:mb-0">
            Hi·ªÉn th·ªã {startIndex + 1}-{Math.min(startIndex + itemsPerPage, filteredCandidates.length)} trong {filteredCandidates.length} ·ª©ng vi√™n
          </span>
          <div className="flex gap-2">
            <button onClick={() => setCurrentPage((p) => Math.max(p - 1, 1))} disabled={currentPage === 1} className="px-3 py-1 bg-white/30 rounded-lg hover:bg-white/40 disabled:opacity-40">Tr∆∞·ªõc</button>
            <span className="px-3 py-1 bg-white/20 rounded-lg">{currentPage} / {totalPages || 1}</span>
            <button onClick={() => setCurrentPage((p) => Math.min(p + 1, totalPages))} disabled={currentPage === totalPages || totalPages === 0} className="px-3 py-1 bg-white/30 rounded-lg hover:bg-white/40 disabled:opacity-40">Sau</button>
          </div>
        </div>
      </div>

      {/* Modal xem h·ªì s∆° */}
      <CandidateProfileModal
        isOpen={isViewModalOpen}
        onClose={() => setIsViewModalOpen(false)}
        candidate={selectedCandidate}
      />
      {/* Modal x√°c nh·∫≠n thay ƒë·ªïi tr·∫°ng th√°i */}
      {isConfirmModalOpen && candidateToToggle && (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-80 text-center">
            <h2 className="text-lg font-bold mb-4">
              {candidateToToggle.status === "ƒêang ho·∫°t ƒë·ªông" ? "V√¥ hi·ªáu h√≥a t√†i kho·∫£n" : "K√≠ch ho·∫°t t√†i kho·∫£n"}
            </h2>
            <p className="mb-6">
              {candidateToToggle.status === "ƒêang ho·∫°t ƒë·ªông"
                ? `B·∫°n c√≥ mu·ªën v√¥ hi·ªáu h√≥a t√†i kho·∫£n c·ªßa ${candidateToToggle.fullName}?`
                : `B·∫°n c√≥ mu·ªën k√≠ch ho·∫°t l·∫°i t√†i kho·∫£n c·ªßa ${candidateToToggle.fullName}?`}
            </p>
            <div className="flex justify-center gap-4">
              <button
                onClick={confirmToggleStatus}
                className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-400"
              >
                ƒê·ªìng √Ω
              </button>
              <button
                onClick={cancelToggleStatus}
                className="px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-200"
              >
                H·ªßy
              </button>
            </div>
          </div>
        </div>
      )}
      
    </div>
  );
};

export default AdminCandidate;
